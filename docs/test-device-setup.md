# テストデバイスの設定ガイド

開発中にテストデバイスを登録することで、自分のデバイスからの広告クリック/表示がカウント対象外になります。

---

## 📱 テストデバイスID の取得方法

### Android デバイスの場合

#### **方法1: adb コマンド（推奨）**

```bash
# PC/Mac のターミナルで実行
adb shell getprop ro.serialno
```

出力例：
```
33BE8D0405244E8D83D03EBB92011234
```

#### **方法2: Logcat 確認**

1. Android Studio を起動
2. Logcat ウィンドウを開く
3. デバイスで Vocabin アプリを実行
4. Logcat に以下のようなメッセージが表示される：

```
I/Ads: Use RequestConfiguration.Builder().setTestDeviceIds(Arrays.asList("33BE8D0405244E8D83D03EBB92011234")) to get test ads on this device.
```

#### **方法3: 開発者向けオプション経由**

1. **設定** → **端末について** → **ビルド番号** を7回タップ
2. 戻って **開発者向けオプション** を開く
3. **デバイスIDを表示** を探してタップ

---

### iOS デバイスの場合

#### **方法1: 設定アプリから**

1. **設定** → **一般** → **情報**
2. **デバイスID** をコピー

例：
```
12345678-1234-1234-1234-123456789012
```

#### **方法2: Xcode 経由**

1. Xcode を起動
2. **Window** → **Devices and Simulators**
3. デバイスを選択し、Identifier をコピー

#### **方法3: iTunes 経由**

1. iTunes でデバイスを接続
2. 概要タブで「シリアル番号」の横にある情報アイコン をクリック
3. デバイスID をコピー

---

## 🔧 Vocabin でテストデバイスを登録する

### ステップ1: デバイスID を確認

上記の方法でデバイスID を取得してコピーしてください。

### ステップ2: config/admob.ts を編集

```typescript
// config/admob.ts

export const TEST_DEVICE_IDS = [
  '33BE8D0405244E8D83D03EBB92011234',  // あなたの Android デバイス
  '12345678-1234-1234-1234-123456789012',  // あなたの iPhone（複数可）
];
```

### ステップ3: アプリを再実行

```bash
npm run android
# または
npm run ios
```

### ステップ4: ログで確認

アプリを起動して、コンソールに以下のメッセージが表示されれば成功：

```
✅ AdMob initialized. Test devices: 2
```

---

## ✅ テストデバイスが正しく登録されたか確認する

### コンソールログを確認

開発モードでアプリを起動し、以下のメッセージを確認：

```
✅ AdMob initialized. Test devices: 1
```

### 広告をテストしてみる

1. ホーム画面に遷移
2. バナー広告が表示される
3. **広告をクリック** しても Google のログに記録されない（重要！）

---

## 🚀 本番環境でのリリース

### リリース前のチェック

```typescript
// ❌ リリース前には必ず空にする！
export const TEST_DEVICE_IDS = [
  // 空のままにする
];
```

**理由：** 本番環境でテストデバイスの登録は不要です。

### 確認事項

- [ ] `TEST_DEVICE_IDS` が空になっている
- [ ] 本番用の広告ユニットID が設定されている
- [ ] `isDevelopment` フラグが正しく動作している

---

## 📊 複数デバイスでの開発

複数のデバイスやエミュレータで開発している場合：

```typescript
export const TEST_DEVICE_IDS = [
  // Android デバイス
  '33BE8D0405244E8D83D03EBB92011234',  // 実機
  'emulator-5554',                      // エミュレータ1
  'emulator-5556',                      // エミュレータ2
  
  // iOS デバイス
  '12345678-1234-1234-1234-123456789012',  // 実機
  // iOS シミュレータは通常登録不要（テスト用IDが自動的に使用される）
];
```

---

## ⚠️ よくある問題

### 問題1: テストデバイスID が見つからない

**解決方法：**
- adb が正しくインストールされているか確認
- `adb devices` でデバイスが認識されているか確認
- デバイスが USB デバッグモードになっているか確認

### 問題2: 広告が表示されない

**原因の可能性：**
- テストデバイスの登録が間違っている
- ネットワーク接続がない
- AdMob の初期化が失敗している

**確認:**
```bash
adb logcat | grep Ads
```

### 問題3: コンソールエラーが出ている

```
❌ Failed to initialize AdMob: ...
```

**原因:**
- `mobileAds` のインポートが失敗している可能性
- ライブラリが正しくインストールされていない

**対応:**
```bash
npm list react-native-google-mobile-ads
```

---

## 📝 まとめ

```
デバイスID 取得
    ↓
config/admob.ts に追加
    ↓
アプリ再実行
    ↓
コンソールで確認
    ↓
広告をテスト（クリック可能）
    ↓
本番環境ではテストデバイス情報をクリア
```

**次のステップ:** [本番用IDの設定ガイド](./production-ads-setup.md)

